# Qt路径计算可视化工具 - 项目需求方案

## 项目概述
开发一个基于Qt的可视化路径计算工具，支持在矩形网格中进行路径搜索算法的可视化展示，并提供数据持久化功能。

## 功能需求

### 1. 界面布局设计

#### 1.1 主界面结构
- **上左区域**: 矩形网格显示区域 (GraphicsView)
- **上右区域**: 操作控制面板 (Control Panel)
- **下方区域**: 计算结果列表 (Result List)
- **底部区域**: 历史记录操作栏 (History Bar)

#### 1.2 界面组件详细说明

##### 上左区域 - 矩形网格显示区域
- 使用 `QGraphicsView` 和 `QGraphicsScene` 实现
- 绘制可配置大小的矩形网格
- 网格点用圆形表示，支持不同状态显示：
  - 普通点：白色圆形
  - 起点：绿色圆形
  - 终点：红色圆形
  - 路径点：蓝色圆形
  - 障碍点：黑色圆形
- 支持鼠标点击设置起点、终点
- 支持路径动画显示（箭头指示方向）

##### 上右区域 - 操作控制面板
包含以下控件：
- **矩形大小设置**
  - 宽度输入框 (SpinBox: 5-50)
  - 高度输入框 (SpinBox: 5-50)
  - 应用按钮
- **路径计算控制**
  - 起点设置按钮
  - 终点设置按钮
  - 开始计算按钮
  - 暂停/继续按钮
  - 停止计算按钮
  - 重新开始按钮
- **算法选择**
  - 算法下拉框 (A*, Dijkstra, BFS等)
- **结果保存**
  - 保存到XML按钮
  - 保存到SQLite按钮

##### 下方区域 - 计算结果列表
- 使用 `QListWidget` 或 `QTableWidget`
- 显示字段：
  - 序号
  - 起点坐标
  - 终点坐标
  - 路径长度
  - 计算时间
  - 算法类型
  - 计算时间戳
- 支持双击显示路径动画
- 支持多选和删除操作

##### 底部区域 - 历史记录操作栏
- 打开XML文件按钮
- 打开SQLite数据库按钮
- 清空当前结果按钮
- 导出功能按钮

### 2. 核心功能需求

#### 2.1 路径计算功能
- **多线程计算**: 使用 `QThread` 在后台执行路径搜索
- **算法支持**:
  - A* 算法
  - Dijkstra 算法
  - 广度优先搜索 (BFS)
  - 深度优先搜索 (DFS)
- **实时进度反馈**: 显示计算进度和状态
- **可中断计算**: 支持暂停和停止操作

#### 2.2 可视化功能
- **网格绘制**: 动态生成指定大小的网格
- **路径动画**: 使用箭头或线条动画显示路径
- **状态指示**: 不同颜色表示不同的点状态
- **缩放和平移**: 支持鼠标滚轮缩放和拖拽平移

#### 2.3 数据持久化功能
- **XML存储**:
  - 保存网格配置
  - 保存计算结果
  - 保存路径数据
- **SQLite存储**:
  - 创建数据表结构
  - 批量保存计算结果
  - 支持查询和过滤
- **数据导入**:
  - 从XML文件加载历史数据
  - 从SQLite数据库加载历史数据

### 3. 技术架构设计

#### 3.1 主要类设计

```
MainWindow (主窗口)
├── GridGraphicsView (网格显示组件)
├── ControlPanel (控制面板)
├── ResultListWidget (结果列表)
├── PathCalculator (路径计算器)
├── DataManager (数据管理器)
└── HistoryManager (历史记录管理器)
```

#### 3.2 UI实现架构

##### 纯代码UI构建策略

- **组件化设计**: 每个功能区域封装成独立的Widget类
- **布局管理**: 使用Qt布局管理器实现响应式设计
- **样式统一**: 通过样式表和主题系统统一界面风格
- **事件处理**: 手动连接信号槽，实现交互逻辑

##### 主要UI类结构

```cpp
class MainWindow : public QMainWindow {
    // 主窗口，负责整体布局和菜单栏
private:
    void setupUI();           // 创建和布局所有UI组件
    void setupConnections();  // 建立信号槽连接
    void setupStyles();       // 应用样式表
};

class GridGraphicsView : public QGraphicsView {
    // 网格显示区域，继承QGraphicsView
    // 完全通过代码创建场景和图形项
};

class ControlPanel : public QWidget {
    // 控制面板，包含所有操作按钮和设置控件
    // 使用QVBoxLayout和QHBoxLayout组织布局
};
```

#### 3.3 线程架构
- **主线程**: UI交互和显示
- **计算线程**: 路径算法计算
- **IO线程**: 文件读写操作

#### 3.3 数据模型设计

##### 网格点数据结构
```cpp
struct GridPoint {
    int x, y;
    PointType type; // Normal, Start, End, Path, Obstacle
    bool visited;
};
```

##### 路径结果数据结构
```cpp
struct PathResult {
    QString id;
    QPoint startPoint;
    QPoint endPoint;
    QVector<QPoint> path;
    QString algorithm;
    int pathLength;
    qint64 calculationTime;
    QDateTime timestamp;
};
```

### 4. 数据库设计

#### 4.1 SQLite表结构

```sql
-- 计算结果表
CREATE TABLE path_results (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    start_x INTEGER NOT NULL,
    start_y INTEGER NOT NULL,
    end_x INTEGER NOT NULL,
    end_y INTEGER NOT NULL,
    algorithm VARCHAR(50) NOT NULL,
    path_data TEXT NOT NULL,  -- JSON格式存储路径点
    path_length INTEGER NOT NULL,
    calculation_time INTEGER NOT NULL,  -- 毫秒
    grid_width INTEGER NOT NULL,
    grid_height INTEGER NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 网格配置表
CREATE TABLE grid_configs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    width INTEGER NOT NULL,
    height INTEGER NOT NULL,
    obstacles TEXT,  -- JSON格式存储障碍点
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 4.2 XML数据格式

```xml
<?xml version="1.0" encoding="UTF-8"?>
<PathCalculationResults>
    <GridConfig width="20" height="15">
        <Obstacles>
            <Point x="5" y="3"/>
            <Point x="8" y="7"/>
        </Obstacles>
    </GridConfig>
    <Results>
        <PathResult id="1" algorithm="A*" timestamp="2024-01-01T12:00:00">
            <StartPoint x="0" y="0"/>
            <EndPoint x="19" y="14"/>
            <Path length="33" calculationTime="15">
                <Point x="0" y="0"/>
                <Point x="1" y="0"/>
                <!-- ... 更多路径点 -->
            </Path>
        </PathResult>
    </Results>
</PathCalculationResults>
```

### 5. 性能要求

#### 5.1 响应性能
- UI响应时间 < 100ms
- 路径计算实时反馈
- 大网格 (50x50) 计算时间 < 5s

#### 5.2 内存管理
- 支持最大 100x100 网格
- 内存使用 < 500MB
- 避免计算过程中的内存泄漏

### 6. 用户体验要求

#### 6.1 操作便利性
- 支持键盘快捷键
- 右键菜单功能
- 拖拽操作支持
- 撤销/重做功能

#### 6.2 视觉效果
- 平滑的动画过渡
- 清晰的状态指示
- 响应式布局设计
- 主题色彩搭配

### 7. 扩展功能 (可选)

#### 7.1 高级算法
- 双向A*算法
- Jump Point Search
- 自定义启发式函数

#### 7.2 网络功能
- 结果分享功能
- 云端数据同步
- 协作编辑功能

#### 7.3 数据分析
- 算法性能对比
- 统计图表显示
- 报告生成功能

### 8. 开发计划

#### 阶段一：基础框架 (2周)
- 主界面布局实现
- 基础网格绘制功能
- 基本的UI交互

#### 阶段二：核心功能 (3周)
- 路径算法实现
- 多线程计算框架
- 基础可视化功能

#### 阶段三：数据功能 (2周)
- XML读写功能
- SQLite数据库操作
- 历史记录管理

#### 阶段四：优化完善 (1周)
- 性能优化
- UI美化
- 测试和调试

### 9. 技术依赖

#### 9.1 Qt模块
- Qt Core
- Qt Widgets
- Qt Gui
- Qt Sql
- Qt Xml
- Qt Concurrent

#### 9.2 开发环境
- Qt 5.15+ 或 Qt 6.x
- C++17 标准
- CMake 或 qmake 构建系统
- 支持 Windows/Linux/macOS

#### 9.3 UI实现方式

- **纯代码构建界面**: 不使用.ui文件，完全通过C++代码创建和布局所有UI组件
- **手动布局管理**: 使用QVBoxLayout、QHBoxLayout、QGridLayout等布局管理器
- **动态UI创建**: 在构造函数或初始化函数中动态创建所有控件
- **样式表应用**: 使用setStyleSheet()方法设置控件外观
- **信号槽连接**: 通过connect()函数手动建立信号槽连接关系

这个需求方案涵盖了您描述的所有功能需求，并提供了详细的技术实现方案。您可以基于这个方案开始具体的代码实现工作。
